⚙️ EC2 Setup Checklist for Your Django App
1. Connect to Your EC2 Instance

If you created an Ubuntu instance:

ssh -i "your-key.pem" ubuntu@your-public-ip

2. Update and Install Essentials
sudo apt update && sudo apt upgrade -y
sudo apt install python3-pip python3-venv nginx redis-server postgresql postgresql-contrib -y

3. Clone Your Project
git clone https://github.com/yourusername/yourproject.git
cd yourproject

4. Set Up Python Environment
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

5. Configure PostgreSQL for django-tenants
sudo -u postgres psql
CREATE DATABASE business;
CREATE USER postgres WITH PASSWORD 'postgres';
ALTER ROLE postgres SET client_encoding TO 'utf8';
ALTER ROLE postgres SET default_transaction_isolation TO 'read committed';
ALTER ROLE postgres SET timezone TO 'UTC';
GRANT ALL PRIVILEGES ON DATABASE business TO postgres;
\q


Update your settings.py:

DATABASES = {
    'default': {
        'ENGINE': 'django_tenants.postgresql_backend',
        'NAME': 'business',
        'USER': 'postgres',
        'PASSWORD': 'postgres',
        'HOST': 'localhost',
        'PORT': 5432,
    }
}

6. Set Up Redis (for django-ratelimit + caching)

Make sure Redis is running:

sudo systemctl enable redis-server
sudo systemctl start redis-server

7. Environment Variables

Create .env in your project root:

DEBUG=False
SECRET_KEY=yourproductionsecret
PAYSTACK_SECRET_KEY=your_key
PAYSTACK_PUBLIC_KEY=your_key
FLW_SECRET_KEY=your_key
FLW_PUBLIC_KEY=your_key
BASE_URL=https://api.flutterwave.com/v3

8. Migrate and Collect Static Files
python manage.py makemigrations
python manage.py migrate_schemas --shared
python manage.py collectstatic

9. Run Gunicorn
pip install gunicorn
gunicorn --workers 3 --bind 0.0.0.0:8000 baxting.wsgi:application


If it works, you’ll see it listening on port 8000.

10. Set Up Nginx Reverse Proxy

Create a config:

sudo nano /etc/nginx/sites-available/baxting


Paste this:

server {
    listen 80;
    server_name your-ec2-public-ip-or-domain;

    location = /favicon.ico { access_log off; log_not_found off; }

    location /static/ {
        alias /home/ubuntu/yourproject/staticfiles/;
    }

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}


Enable it:

sudo ln -s /etc/nginx/sites-available/baxting /etc/nginx/sites-enabled
sudo nginx -t
sudo systemctl restart nginx

11. (Optional) Set Up HTTPS with Certbot
sudo apt install certbot python3-certbot-nginx -y
sudo certbot --nginx -d yourdomain.com

12. Keep Gunicorn Running

Install supervisor to auto-start your app:

sudo apt install supervisor -y
sudo nano /etc/supervisor/conf.d/baxting.conf


Paste:

[program:baxting]
directory=/home/ubuntu/yourproject
command=/home/ubuntu/yourproject/venv/bin/gunicorn --workers 3 --bind unix:/home/ubuntu/yourproject/baxting.sock baxting.wsgi:application
autostart=true
autorestart=true
stderr_logfile=/var/log/baxting.err.log
stdout_logfile=/var/log/baxting.out.log
user=ubuntu


Then run:

sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl restart baxting


✅ Now your Django tenants app runs on EC2 with Nginx + Gunicorn + PostgreSQL + Redis!

Would you like me to show you how to:

Add each tenant domain automatically to your EC2 Nginx config (so each tenant gets their subdomain live), or

Integrate your dynamic Flutterwave subaccount per tenant next?













[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/Tenant
EnvironmentFile=/home/ubuntu/Tenant/.env
ExecStart=/home/ubuntu/Tenant/venv/bin/gunicorn \
          --workers 3 \
          --bind unix:/tmp/gunicorn.sock \
          baxting.wsgi:application

[Install]
WantedBy=multi-user.target



Install PostgreSQL:

sudo apt update
sudo apt install postgresql postgresql-contrib


Start PostgreSQL:

sudo systemctl start postgresql
sudo systemctl enable postgresql
sudo systemctl status postgresql


Make sure your DB, user, and password exist and match .env:

sudo -u postgres psql
CREATE DATABASE business;
CREATE USER myuser WITH PASSWORD 'mypassword';
GRANT ALL PRIVILEGES ON DATABASE business TO myuser;


Then ensure your .env file matches these credentials.

✅ After these fixes

Activate your venv: source venv/bin/activate

Run migrations:

python manage.py migrate_schemas --shared
python manage.py migrate


Start Gunicorn (or systemctl restart if usin





1️⃣ Connect to PostgreSQL
sudo -u postgres psql

2️⃣ Connect to your database
\c business


This switches you to the business database.

3️⃣ Grant privileges to your user
Replace myuser with the username you actually use in Django’s .env (DB_USER):

GRANT ALL PRIVILEGES ON SCHEMA public TO myuser;

4️⃣ Make sure your user can create databases
ALTER USER myuser CREATEDB;

5️⃣ Exit
\q


✅ After this, your Django migrations should work without permission errors.
If you want, I can give you the exact commands for your .env user setup so you won’t have to guess the username. Do you want me to do that?